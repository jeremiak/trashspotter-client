<!doctype html>
<html lang="en">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
    <style type="text/css">
      body {
        text-align:center;
      }
      h3 {
        font-size:60pt;
      }
    </style>
  </head>
  <body>
    <h1>TrashSpotter</h1>
    <h3 id="trash" class="glyphicon glyphicon-trash"></h3>
    <script type="text/javascript">
      var ts = {};
      ts.herokuHost = 'http://trashspotter--api-herokuapp-com-ptypn8aumpr3.runscope.net';
      ts.pingHeroku = function() {
        var xhr = new XMLHttpRequest();
        xhr.open('GET', ts.herokuHost + '/awake');
        xhr.send();
      };
      ts.getLocation = function () {
        function success(data) {
          console.log('location successfully retrieved');
          ts['coords'] = data['coords'];
        }
        function error(reason) {
          console.log(reason);
        }
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(success, error);
        } else {
          error('not supported');
        }
      };
      ts.registerGarbageCan = function() {
        var date = Date.now(),
            parameters,
            xhr = new XMLHttpRequest();

        parameters = encodeURI('lat=' + ts['coords']['latitude'] + '&long=' + ts['coords']['longitude'] + '&date=' + date);
        xhr.open('POST', ts.herokuHost + '/garbage_can');
        xhr.send(parameters);
      };
      
      ts.init = function() {
        ts.getLocation();
        document.getElementById('trash').addEventListener('click', ts.registerGarbageCan);
      };

      ts.init();
    </script>
  </body>
</html>
